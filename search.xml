<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>完全备份+二进制日志备份</title>
      <link href="/2021/09/20/wan-quan-bei-fen-er-jin-zhi-ri-zhi-bei-fen/"/>
      <url>/2021/09/20/wan-quan-bei-fen-er-jin-zhi-ri-zhi-bei-fen/</url>
      
        <content type="html"><![CDATA[<h1 id="首先确保服务器开启二进制日志"><a href="#首先确保服务器开启二进制日志" class="headerlink" title="首先确保服务器开启二进制日志"></a><em><strong>首先确保服务器开启二进制日志</strong></em></h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h5 id="查看二进制文件"><a href="#查看二进制文件" class="headerlink" title="查看二进制文件"></a>查看二进制文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># ls</span></span><br><span class="line">auto.cnf         client-key.pem  ib_logfile1           localhost-bin.000004       localhost-slow.log  private_key.pem  server-key.pem  wp</span><br><span class="line">backup           game            ibtmp1                localhost-bin.index        mysql               public_key.pem   sys             wxj</span><br><span class="line">ca-key.pem       ib_buffer_pool  localhost-bin.000001  localhost.localdomain.err  mysql.sock          sanchuang        TENNIS</span><br><span class="line">ca.pem           ibdata1         localhost-bin.000002  localhost.localdomain.pid  mysql.sock.lock     sanchuang123     <span class="built_in">test</span></span><br><span class="line">client-cert.pem  ib_logfile0     localhost-bin.000003  localhost.log              performance_schema  server-cert.pem  w</span><br><span class="line">[root@localhost mysql]<span class="comment"># mysqlbinlog localhost-bin.000004</span></span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;</span><br><span class="line">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;</span><br><span class="line">DELIMITER /*!*/;</span><br><span class="line"><span class="comment"># at 4</span></span><br><span class="line"><span class="comment">#210401 17:02:45 server id 1  end_log_pos 123 CRC32 0xa84b7737 Start: binlog v 4, server v 5.7.33-log created 210401 17:02:45</span></span><br><span class="line"><span class="comment"># Warning: this binlog is either in use or was not closed properly.</span></span><br><span class="line">BINLOG <span class="string">&#x27;</span></span><br><span class="line"><span class="string">NYxlYA8BAAAAdwAAAHsAAAABAAQANS43LjMzLWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span></span><br><span class="line"><span class="string">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA</span></span><br><span class="line"><span class="string">ATd3S6g=</span></span><br><span class="line"><span class="string">&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment"># at 123</span></span><br><span class="line"><span class="comment">#210401 17:02:45 server id 1  end_log_pos 154 CRC32 0x3d6a0e33 Previous-GTIDs</span></span><br><span class="line"><span class="comment"># [empty]</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;AUTOMATIC&#x27;</span> /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment"># End of log file</span></span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure><h5 id="查看位置"><a href="#查看位置" class="headerlink" title="查看位置"></a>查看位置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@(none) 20:53  mysql&gt;show master status;</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                 | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| localhost-bin.000004 |      154 |              |                  |                   |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="1-创建完全备份"><a href="#1-创建完全备份" class="headerlink" title="1.创建完全备份"></a>1.创建完全备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># mysqldump -uroot -p&#x27;wp123456&#x27; --databases wp &gt;/backup/wp.sql</span></span><br><span class="line">mysqldump: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br></pre></td></tr></table></figure><h3 id="2-模拟数据发生变化"><a href="#2-模拟数据发生变化" class="headerlink" title="2.模拟数据发生变化"></a>2.模拟数据发生变化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@(none) 20:53  mysql&gt;show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| wp                 |</span><br><span class="line">+--------------------+</span><br><span class="line">root@game 21:01  mysql&gt;use wp;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">root@wp 21:02  mysql&gt;insert into trans_demo(id,name) values(4,<span class="string">&#x27;lisa&#x27;</span>);</span><br><span class="line">Query OK, 1 row affected (0.53 sec)</span><br><span class="line"></span><br><span class="line">root@wp 21:03  mysql&gt;insert into trans_demo(id,name) values(5,<span class="string">&#x27;jack&#x27;</span>);</span><br><span class="line">Query OK, 1 row affected (0.11 sec)</span><br></pre></td></tr></table></figure><h3 id="3-查看位置号"><a href="#3-查看位置号" class="headerlink" title="3.查看位置号"></a>3.查看位置号</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@wp 21:03  mysql&gt;show master status;</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                 | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| localhost-bin.000004 |      154 |              |                  |                   |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.09 sec)</span><br></pre></td></tr></table></figure><h3 id="4-模拟出现意外，数据库数据丢失"><a href="#4-模拟出现意外，数据库数据丢失" class="headerlink" title="4.模拟出现意外，数据库数据丢失"></a>4.模拟出现意外，数据库数据丢失</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@wp 21:05  mysql&gt;drop database wp;</span><br><span class="line">Query OK, 3 rows affected (1.21 sec)</span><br></pre></td></tr></table></figure><h5 id="查看数据库，确认库已被删除"><a href="#查看数据库，确认库已被删除" class="headerlink" title="查看数据库，确认库已被删除"></a>查看数据库，确认库已被删除</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@(none) 21:06  mysql&gt;show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema | </span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">|                    |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure><h3 id="5-恢复数据"><a href="#5-恢复数据" class="headerlink" title="5.恢复数据"></a>5.恢复数据</h3><ul><li>恢复完全备份</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># mysql -uroot -p&#x27;wp123456&#x27; &lt;/backup/wp.sql</span></span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br></pre></td></tr></table></figure><p>此时的数据还没有完全恢复</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@wp 21:38  mysql&gt;select * from trans_demo;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | name |</span><br><span class="line">+------+------+</span><br><span class="line">|    3 | cali |</span><br><span class="line">|    1 | bob  |</span><br><span class="line">|    2 | ROSE |</span><br><span class="line">+------+------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><ul><li>二进制日志恢复数据</li></ul><ol><li><p>通过位置点恢复</p><p> 查看二进制日志关于drop数据库的部分</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># mysqlbinlog localhost-bin.000004|egrep -C 5 &#x27;drop database&#x27;</span></span><br><span class="line"><span class="comment">#210401 21:06:44 server id 1  end_log_pos 749 CRC32 0x4232993e Anonymous_GTIDlast_committed=2sequence_number=3rbr_only=no</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;ANONYMOUS&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment"># at 749</span></span><br><span class="line"><span class="comment">#210401 21:06:44 server id 1  end_log_pos 835 CRC32 0x39092363 Querythread_id=60exnec_time=1error_code=0</span></span><br><span class="line">SET TIMESTAMP=1617282404/*!*/;</span><br><span class="line">drop database wp</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 835</span></span><br><span class="line"><span class="comment">#210401 21:35:54 server id 1  end_log_pos 900 CRC32 0x8ebec48f Anonymous_GTIDlast_committed=3sequence_number=4rbr_only=no</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;ANONYMOUS&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment"># at 900</span></span><br></pre></td></tr></table></figure><p> 获得drop数据的位置点</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># at 749</span></span><br><span class="line"><span class="comment">#210401 21:06:44 server id 1  end_log_pos 835 CRC32 0x39092363 Querythread_id=60exec_time=1error_code=0</span></span><br><span class="line">SET TIMESTAMP=1617282404/*!*/;</span><br><span class="line">drop database wp</span><br></pre></td></tr></table></figure><p> 位置点为 # at 749</p><p> 恢复</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># mysqlbinlog --start-position=154 --stop-position=749 localhost-bin.000004 |mysql -uroot -p&#x27;wp123456&#x27;</span></span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br></pre></td></tr></table></figure><p> 恢复成功</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@wp 21:49  mysql&gt;select * from trans_demo;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | name |</span><br><span class="line">+------+------+</span><br><span class="line">|    3 | cali |</span><br><span class="line">|    1 | bob  |</span><br><span class="line">|    2 | ROSE |</span><br><span class="line">|    4 | lisa |</span><br><span class="line">|    5 | jack |</span><br><span class="line">+------+------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p>通过时间来恢复</p><p> 查看二进制日志关于drop数据库的部分</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># mysqlbinlog localhost-bin.000004|egrep -C 5 &#x27;drop database&#x27;</span></span><br><span class="line"><span class="comment"># at 31294</span></span><br><span class="line"><span class="comment">#210402 13:01:12 server id 1  end_log_pos 31380 CRC32 0xae8350ad Querythread_id=77exec_time=0error_code=0</span></span><br><span class="line">SET TIMESTAMP=1617339672/*!*/;</span><br><span class="line">SET @@session.pseudo_thread_id=77/*!*/;</span><br><span class="line">SET @@session.sql_mode=1436549152/*!*/;</span><br><span class="line">drop database wp</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 31380</span></span><br><span class="line"><span class="comment">#210403 16:20:54 server id 1  end_log_pos 31431 CRC32 0xb277e494 Rotate to localhost-bin.000005  pos: 4</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;AUTOMATIC&#x27;</span> /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><ul><li>获得drop数据的时间点</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#210402 13:01:12</span></span><br></pre></td></tr></table></figure><p> 通过时间点恢复</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># mysqlbinlog  --stop-datetime=&#x27;2021-04-02 13:01:12&#x27; localhost-bin.000004|mysql -uroot -p&#x27;wp123456&#x27;</span></span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br></pre></td></tr></table></figure><p> 恢复成功</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@wp 16:24  mysql&gt;select * from trans_demo;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | name |</span><br><span class="line">+------+------+</span><br><span class="line">|    3 | cali |</span><br><span class="line">|    1 | bob  |</span><br><span class="line">|    2 | ROSE |</span><br><span class="line">|    4 | lisa |</span><br><span class="line">|    5 | jack |</span><br><span class="line">+------+------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何解决centos8下载速度慢</title>
      <link href="/2021/09/19/ru-he-jie-jue-centos8-xia-zai-su-du-man/"/>
      <url>/2021/09/19/ru-he-jie-jue-centos8-xia-zai-su-du-man/</url>
      
        <content type="html"><![CDATA[<h1 id="如何解决centos8下载速度慢"><a href="#如何解决centos8下载速度慢" class="headerlink" title="如何解决centos8下载速度慢"></a>如何解决centos8下载速度慢</h1><h2 id="原因分析："><a href="#原因分析：" class="headerlink" title="原因分析："></a>原因分析：</h2><p>由于yum源的镜像在国外，所以导致国内的下载速度偏慢，使用国内的镜像即可解决此问题。<br>1</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>1.<code>cd /etc/yum.repos.d </code>进入yum源目录</p><p><code>mkdir backup </code>建立备份目录</p><p>2.<code>mv *.repo backup/</code>备份原有的镜像，目的是存放linux系统默认的repo文件，让yum找不到默认的仓库文件</p><p>3.<code>curl -O https://mirrors.aliyun.com/repo/Centos-8.repo </code>下载镜像，此为centos8的镜像<br>Centos5 <a href="https://mirrors.aliyun.com/repo/Centos-5.repo">https://mirrors.aliyun.com/repo/Centos-5.repo</a><br>Centos6 <a href="https://mirrors.aliyun.com/repo/Centos-6.repo">https://mirrors.aliyun.com/repo/Centos-6.repo</a><br>Centos7 <a href="https://mirrors.aliyun.com/repo/Centos-7.repo">https://mirrors.aliyun.com/repo/Centos-7.repo</a><br>Centos8 <a href="https://mirrors.aliyun.com/repo/Centos-8.repo">https://mirrors.aliyun.com/repo/Centos-8.repo</a></p><p>4.<code>yum install go -y</code>下载</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
